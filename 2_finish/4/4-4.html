<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>canvasゲーム</title>
		<meta name="viewport" content="width=322">
		<style>
			* {
				margin: 0;
				padding: 0;
			}

			body {
				text-align: center;
			}

			#canvas {
				border: 1px solid gray;
			}
		</style>
	</head>
	<body>
		<p><canvas id="canvas" width="320" height="480"></canvas></p>
		<script>
			const canvas = document.getElementById("canvas");
			const ctx = canvas.getContext("2d");

			//変数の設定と初期化
			const target = { x: 250, y: 100, dir: 1 };  	// ターゲット（位置と移動方向）
			const player = { x: 250, y: 400 };					// プレイヤー（位置）
			const ball = { x: -10, y: -10 };						// ボール（位置） 
			let point = 0;												// 得点

			setInterval(loop, 50);

			function loop() {											//アニメ関数
				ctx.clearRect(0, 0, 320, 480);					//画面をクリア

				ctx.fillStyle = "black";
				ctx.fillRect(target.x - 25, target.y - 25, 50, 10);				//targetを描画

				ctx.fillStyle = "black";
				ctx.font = "20px sans-serif ";
				ctx.fillText(point, target.x, target.y - 30);					//得点表示

				ctx.fillStyle = "blue";
				ctx.fillRect(player.x - 25, player.y - 5, 50, 10);				//playerを描画

				ctx.fillStyle = "red";
				ctx.fillRect(ball.x - 5, ball.y - 5, 10, 10);					//ballを描画

				//移動計算
				target.x += target.dir;
				ball.y -= 5;
				//壁衝突計算
				if ((target.x < 25) || (295 < target.x)) { target.dir *= -1; }
				//得点ゲット
				if ((100 === ball.y) && (Math.abs(target.x - ball.x) < 25)) {
					point++;
				}
			}

			//シュートするイベント処理(後述)
			canvas.addEventListener(
				"mousedown",
				(e) => {
					ball.x = player.x;
					ball.y = player.y;
				}
			);

			//マウスで自分キャラを動かすイベント処理(後述)
			canvas.addEventListener(
				"mousemove",
				(e) => {
					const rect = e.target.getBoundingClientRect();
					player.x = e.clientX - rect.left;
				}
			);
		</script>
	</body>
</html>