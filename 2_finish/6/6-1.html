<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>6-1</title>
	<meta name="viewport" content="width=320">
	<style>
		*{
			margin:0;padding:0;
			box-sizing:border-box;
		}
		body{
			margin:0 auto;
			width:320px;
			border:1px solid gray;
			background-color:white;
		}
		h1{text-align:center;}
		ul{list-style:none;}
		li:nth-of-type(odd){background-color:#eee;}
		#chizu{width:318px; height:245px;}
		button{
			font-size:20px;
			width:33%;
			display:block;
			float:left;
			border:1px solid gray;
			background-color:#eee;
		}
		button:last-of-type{width:34%;}
		#msg1,#msg2{width:50%;float:left;}	
	</style>

	<script src="https://maps.google.com/maps/api/js?key=AIzaSyD6A3ILDkpS2KuVV1SlAAJtBTv5lMfnkwY"></script>
</head>
<body>
	<div>
		<div id="msg1">メッセージ</div>
		<div id="msg2">ステイタス</div>
		<div style="clear:both;"></div>
	</div>
	<div id=button>
		<button onclick="get1();">一時取得</button>
		<button onclick="get2();">継続取得</button>
		<button onclick="get3();">継続終了</button>
	</div>
	<ul>
		<li id="chizu">地図</li>
		<li id="ido">緯度</li>
		<li id="keido">経度</li>
		<li id="kodo">高度</li>
		<li id="hogaku">方角</li>
		<li id="sokudo">速度</li>
		<li id="jusho">住所</li>
		<li id="michijun">東京タワーへの道順</li>
	</ul>
	<script>
		let nav;
		const MSG1 = document.getElementById("msg1");
		const MSG2 = document.getElementById("msg2");
		const CHIZU = document.getElementById("chizu");
		const IDO = document.getElementById("ido");
		const KEIDO = document.getElementById("keido");
		const KODO = document.getElementById("kodo");
		const HOGAKU = document.getElementById("hogaku");
		const SOKUDO = document.getElementById("sokudo");
		const JUSHO = document.getElementById("jusho");
		const MICHIJUN = document.getElementById("michijun");
	 
		//使用可否をチェック
		if(navigator.geolocation){
			MSG1.innerHTML = "使用できます";
		}else{
			MSG1.innerHTML = "使用できません";
		}
	
		//Android用オプション
		const OPTION={enableHighAccuracy:true,timeout:10000,maximumAge:0};
	
		// 一次取得
		function get1(){
			navigator.geolocation.getCurrentPosition(seiko,shippai,OPTION);
			MSG2.innerHTML = "一時情報取得済";
		}
		
		// 連続取得
		function get2(){
			nav = navigator.geolocation.watchPosition(seiko,shippai,OPTION);
			MSG2.innerHTML = "継続情報取得中";
		}
		
		// 連続取得の終了
		function get3(){
			navigator.geolocation.clearWatch(nav);
			MSG2.innerHTML = "継続情報取得終了";
		}
		
		//成功した場合の処理
		function seiko(position){
			//修正
			let latitude = position.coords.latitude;
			let longitude = position.coords.longitude;
			let altitude = position.coords.altitude;
			let heading = position.coords.heading;
			let speed = position.coords.speed;
			
			//追加
			IDO.innerHTML = "緯度:" + latitude;
			KEIDO.innerHTML = "経度:" + longitude;
			KODO.innerHTML = "高度:" + altitude;
			HOGAKU.innerHTML = "方角:" + heading;
			SOKUDO.innerHTML = "速度:" + speed;
			
			//地図描画
			
			const GENZAICHI = new google.maps.LatLng(latitude,longitude);
			const GMAP = new google.maps.Map(
				CHIZU,
				{zoom:12,center:GENZAICHI,mapTypeId:google.maps.MapTypeId.ROADMAP}
			);
		
			//マーカの表示
			const MARKER= new google.maps.Marker({position:GENZAICHI,map:GMAP});
			const INFOWINDOW = new google.maps.InfoWindow({content:"現在地"});
			INFOWINDOW.open(GMAP,MARKER);
		
			//住所の取得
			const GEOCODER = new google.maps.Geocoder();
			GEOCODER.geocode(
				{'latLng':GENZAICHI},
				(res,status)=>{
					if(status != google.maps.GeocoderStatus.OK){
						JUSHO.innerHTML = "失敗"+status;return;
					}
					JUSHO.innerHTML = res[0].formatted_address;
				}
			);
		
			//道順
			const TOKYOTOWER= "35.65862127808128,139.74542051553726";
			michijun.innerHTML = "<a target=_blank href='https://maps.google.com?dirflag=r&daddr="+TOKYOTOWER+ "&saddr=" +latitude+ "," +longitude+ "'>東京タワーへの道順</a>";
		}
	
		//失敗
		function shippai(err){alert("失敗"+err.code+err.message);}

	</script>
</body>
</html>