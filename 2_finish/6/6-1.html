<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>6-1</title>
	<meta name="viewport" content="width=320">
	<style>
		*{
			margin:0;padding:0;
			box-sizing:border-box;
		}
		body{
			margin:0 auto;
			width:320px;
			border:1px solid gray;
			background-color:white;
		}
		h1{text-align:center;}
		ul{list-style:none;}
		li:nth-of-type(odd){background-color:#eee;}
		#chizu{width:318px; height:245px;}
		button{
			font-size:20px;
			width:33%;
			display:block;
			float:left;
			border:1px solid gray;
			background-color:#eee;
		}
		button:last-of-type{width:34%;}
		#msg1,#msg2{width:50%;float:left;}	
	</style>

	<script src="https://maps.google.com/maps/api/js?key=AIzaSyD6A3ILDkpS2KuVV1SlAAJtBTv5lMfnkwY"></script>
</head>
<body>
	<div>
		<div id="msg1">メッセージ</div>
		<div id="msg2">ステイタス</div>
		<div style="clear:both;"></div>
	</div>
	<div id=button>
		<button onclick="get1();">一時取得</button>
		<button onclick="get2();">継続取得</button>
		<button onclick="get3();">継続終了</button>
	</div>
	<ul>
		<li id="chizu">地図</li>
		<li id="ido">緯度</li>
		<li id="keido">経度</li>
		<li id="kodo">高度</li>
		<li id="hogaku">方角</li>
		<li id="sokudo">速度</li>
		<li id="jusho">住所</li>
		<li id="michijun">東京タワーへの道順</li>
	</ul>
	<script>
		var nav;
		var msg1 = document.getElementById("msg1");
		var msg2 = document.getElementById("msg2");
		var chizu = document.getElementById("chizu");
		var ido = document.getElementById("ido");
		var keido = document.getElementById("keido");
		var kodo = document.getElementById("kodo");
		var hogaku = document.getElementById("hogaku");
		var sokudo = document.getElementById("sokudo");
		var jusho = document.getElementById("jusho");
		var michijun = document.getElementById("michijun");
	 
		//使用可否をチェック
		if(navigator.geolocation){
			msg1.innerHTML = "使用できます";
		}else{
			msg1.innerHTML = "使用できません";
		}
	
		//Android用オプション
		var option={enableHighAccuracy:true,timeout:10000,maximumAge:0};
	
		// 一次取得
		function get1(){
			navigator.geolocation.getCurrentPosition(seiko,shippai,option);
			msg2.innerHTML = "一時情報取得済";
		}
		
		// 連続取得
		function get2(){
			nav = navigator.geolocation.watchPosition(seiko,shippai,option);
			msg2.innerHTML = "継続情報取得中";
		}
		
		// 連続取得の終了
		function get3(){
			navigator.geolocation.clearWatch(nav);
			msg2.innerHTML = "継続情報取得終了";
		}
		
		//成功した場合の処理
		function seiko(position){
			//修正
			var latitude = position.coords.latitude;
			var longitude = position.coords.longitude;
			var altitude = position.coords.altitude;
			var heading = position.coords.heading;
			var speed = position.coords.speed;
			
			//追加
			ido.innerHTML = "緯度:" + latitude;
			keido.innerHTML = "経度:" + longitude;
			kodo.innerHTML = "高度:" + altitude;
			hogaku.innerHTML = "方角:" + heading;
			sokudo.innerHTML = "速度:" + speed;
			
			//地図描画
			
			var genzaichi = new google.maps.LatLng(latitude,longitude);
			var gmap = new google.maps.Map(chizu,{zoom:12,center:genzaichi,
				mapTypeId:google.maps.MapTypeId.ROADMAP}
			);
		
			//マーカの表示
			var marker = new google.maps.Marker({position:genzaichi,map:gmap});
			var infoWindow = new google.maps.InfoWindow({content:"現在地"});
			infoWindow.open(gmap,marker);
		
			//住所の取得
			var geocoder = new google.maps.Geocoder();
			geocoder.geocode({'latLng':genzaichi},function(res,status){
				if(status != google.maps.GeocoderStatus.OK){
					jusho.innerHTML = "失敗"+status;return;
				}
				jusho.innerHTML = res[0].formatted_address;
			});
		
			//道順
			var tokyoTower = "35.65862127808128,139.74542051553726";
			michijun.innerHTML = "<a target=_blank href='https://maps.google.com?dirflag=r&daddr="+tokyoTower+ "&saddr=" +latitude+ "," +longitude+ "'>東京タワーへの道順</a>";
		}
	
		//失敗
		function shippai(err){alert("失敗"+err.code+err.message);}

	</script>
</body>
</html>